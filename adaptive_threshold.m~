%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%function thresh = adaptive_threshold(col, row)
%
%Divides the original image into k*k sections. Graythresh is used within
%every section resulting in k*k threshold values (thresholds).
%Part of a pattern recognition project TNM034 - Advanced Image Processing, Linköping
%University HT2014.
%
%Copyright (c) <2014> Karolin Jonsson, Louise Carlström, Linnea Nåbo, Linnea Mellblom
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function thresholds = adaptive_threshold(img, k)

img = imread('images/img_newSet/Husannons_full_Illum.png');
%img = imread('images/img_set2/Hus_1.png');
k = 3;

imshow(img);
figure;

%Skapa en matris där k*k st tröskelvärden sparas
%thresholds = zeros(k)

[height, width, depth] = size(img) % height and width (depth is not used but needs to be there so "size" works correctly

BW_test = img;

BW_img = zeros(height, width);
size_BW = size(BW_img)

h_step = floor(height/k)
w_step = floor(width/k)

place = 1;
for i=1:h_step:height
    for j=1:w_step:width
        if(place <= k*k)
            place
            temp_tresh = graythresh( img((i:i+h_step-1), (j:j+w_step-1)) );
            BW_img( (i:i+h_step-1), (j:j+w_step-1) ) = im2bw( (img( (i:i+h_step-1), (j:j+w_step-1) )), temp_tresh );
            BW_test = im2bw(  (img( (i:i+h_step-1), (j:j+w_step-1) )), temp_tresh );
            place = place+1;
            temp_thresh = 0;
        end
    end
end

size_BW = size(BW_img)
size_img = size(img)

imshow(BW_img);




